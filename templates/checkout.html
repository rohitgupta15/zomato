{% extends "base.html" %}

{% block title %}Checkout · FoodBooking{% endblock %}

{% block content %}
  <section class="section">
    <h2>Checkout</h2>
    <p class="lead">Complete your delivery details and choose a payment method.</p>
    <form class="auth-card" method="post">
      {% csrf_token %}
      <input type="hidden" name="delivery_latitude" id="delivery_latitude" />
      <input type="hidden" name="delivery_longitude" id="delivery_longitude" />
      <label class="field">
        <span>Name</span>
        <input type="text" name="name" value="{{ user.username }}" required />
      </label>
      <label class="field">
        <span>Phone</span>
        <input type="text" name="phone" required />
      </label>
      <label class="field">
        <span>Address</span>
        <input type="text" name="address" required />
      </label>
      <label class="field">
        <span>Payment</span>
        <select name="payment">
          <option value="COD">Cash on Delivery</option>
          <option value="ONLINE">Online (Mock)</option>
        </select>
      </label>
      <div class="cart-summary">
        <div>Total: <strong>₹{{ total }}</strong></div>
      </div>
      <button class="btn primary" type="submit">Place Order</button>
    </form>
    <p class="muted">
      Payment integration placeholder. Wire Razorpay/Stripe in this step.
    </p>
  </section>

  <script>
    (function () {
      if (!navigator.geolocation) return;
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const lat = document.getElementById("delivery_latitude");
          const lng = document.getElementById("delivery_longitude");
          if (lat && lng) {
            lat.value = pos.coords.latitude;
            lng.value = pos.coords.longitude;
          }
        },
        () => {},
        { enableHighAccuracy: true, timeout: 5000, maximumAge: 60000 }
      );
    })();
  </script>
{% endblock %}
